<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGI Job NFT Marketplace</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #4A148C, #880E4F);
            color: #ffffff;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 90%;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #FFEB3B;
            margin-bottom: 40px;
            font-size: 2.5rem;
        }
        h2.subtitle {
            text-align: center;
            color: #FFEB3B;
            margin-bottom: 40px;
            font-size: 1.5rem;
        }
        .card {
            background-color: #1A237E;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .card h2 {
            margin-top: 0;
            color: #FFEB3B;
        }
        .card p {
            margin: 10px 0;
            font-size: 1em;
        }
        .jobs-table {
            width: 100%;
            border-collapse: collapse;
        }
        .jobs-table th, .jobs-table td {
            border: 1px solid #FFEB3B;
            padding: 10px;
            text-align: left;
        }
        .jobs-table th {
            background-color: #FFEB3B;
            color: #4A148C;
        }
        .jobs-table tbody tr:nth-child(even) {
            background-color: #2A2B5E;
        }
        .jobs-table tbody tr:nth-child(odd) {
            background-color: #1A237E;
        }
        .btn {
            background-color: #FFEB3B;
            color: #4A148C;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 1em;
            border-radius: 5px;
            margin: 5px 0;
        }
        .btn:hover {
            background-color: #FFC107;
        }
        .subdomain-verification {
            background-color: #3F51B5;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            margin: 10px;
            text-align: center;
        }
        .subdomain-verification label {
            font-size: 18px;
            margin-bottom: 10px;
            display: block;
            color: #FFEB3B;
        }
        .subdomain-verification input[type="text"] {
            width: 80%;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 10px;
            font-size: 18px;
            text-align: center;
            margin: 0 auto;
        }
        .subdomain-verification button {
            background-color: #673AB7;
            color: white;
            border: none;
            font-weight: bold;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 80%;
            margin-top: 10px;
        }
        .subdomain-verification button:hover {
            background-color: #5E35B1;
        }
        .subdomain-verification p {
            margin-top: 15px;
            font-size: 18px;
            color: #ffffff;
        }
        .verified-subdomains ul {
            list-style: none;
            padding: 0;
            color: #ffffff;
            font-size: 1rem;
        }
        .verified-subdomains ul li {
            margin: 5px 0;
        }
        .nft-section ul {
            list-style: none;
            padding: 0;
            color: #ffffff;
            font-size: 1rem;
        }
        .nft-section ul li {
            margin: 5px 0;
        }
        .nft-image {
            max-width: 100px;
            border: 1px solid #FFEB3B;
            border-radius: 8px;
            margin-right: 10px;
        }
        .nft-list-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .nft-link {
            color: #FFD700;
            margin-right: 20px;
        }
        .agi-purchase {
            text-align: center;
            background-color: #4527A0;
            padding: 20px;
            border-radius: 16px;
            margin-top: 20px;
        }
        .agi-purchase input[type="number"] {
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 10px;
            font-size: 18px;
            margin-right: 10px;
        }
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            h2.subtitle {
                font-size: 1rem;
            }
            .card {
                padding: 15px;
            }
            .card h2 {
                font-size: 1.5rem;
            }
            .card p, .btn {
                font-size: 0.9rem;
            }
            .jobs-table th, .jobs-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AGI Job NFT Marketplace</h1>
        <h2 class="subtitle">[ Jobs.AGI.eth üóùÔ∏èüëæ ] : Post jobs, pay in $AGI.<br><br>Validators (AGI Club Members) ensure top-notch job quality and transparency.</h2>
        <div class="card">
            <h2>Summary</h2>
            <p>Total Jobs: <span id="total-jobs">0</span></p>
            <p>Validator Approvals Required: <span id="validator-approvals">0</span></p>
            <p>Validator Disapprovals Required: <span id="validator-disapprovals">0</span></p>
        </div>
        <div class="card">
            <h2>My Holdings</h2>
            <p>My $AGI Balance: <span id="agi-balance">0</span></p>
            <p>My Jobs: <span id="my-jobs">0</span></p>
            <p>My Reputation: <span id="my-reputation">0</span></p>
        </div>
        <div class="card">
            <h2>Create a Job</h2>
            <p>Follow the steps below to create a job:</p>
            <ol>
                <li>Ensure you are connected to your wallet. If not, click the "Connect Wallet" button below.</li>
                <li>Fill in the job details in the form provided when you click the "Create Job" button:</li>
                <ul>
                    <li><strong>IPFS Hash:</strong> Enter the IPFS hash of the job details document.</li>
                    <li><strong>Payout:</strong> Specify the payout amount in $AGI.</li>
                    <li><strong>Duration:</strong> Enter the job duration in seconds.</li>
                    <li><strong>Details:</strong> Provide a brief description of the job.</li>
                </ul>
                <li>Click the "Create Job" button to submit your job. Make sure you have approved the necessary $AGI token amount for the job payout.</li>
            </ol>
            <button class="btn" onclick="createJob()">Create Job</button>
        </div>
        <div class="card">
            <h2>Manage Jobs</h2>
            <button class="btn" onclick="applyForJob()">Apply for Job</button>
            <button class="btn" onclick="requestJobCompletion()">Request Job Completion</button>
            <button class="btn" id="validateJobBtn" style="display: none;" onclick="validateJob()">Validate Job</button>
        </div>
        <div class="subdomain-verification">
            <label for="subdomainAgent">Enter Your AGI Agent Subdomain Identity:</label>
            <input type="text" id="subdomainAgent" name="subdomainAgent">
            <button onclick="verifyAgentOwnership()">Verify Agent Ownership</button>
            <p id="outputAgent"></p>
        </div>
        <div class="subdomain-verification">
            <label for="subdomainNode">Enter Your AGI Node Subdomain Identity:</label>
            <input type="text" id="subdomainNode" name="subdomainNode">
            <button onclick="verifyNodeOwnership()">Verify Node Ownership</button>
            <p id="outputNode"></p>
        </div>
        <div class="subdomain-verification">
            <label for="subdomainClub">Enter Your AGI Club Subdomain Identity:</label>
            <input type="text" id="subdomainClub" name="subdomainClub">
            <button onclick="verifyClubOwnership()">Verify Club Ownership</button>
            <p id="outputClub"></p>
            <button class="btn" onclick="window.open('https://montrealai.xyz/club.html', '_blank')">Buy AGI Club Subdomain Identity</button>
        </div>
        <div class="card">
            <h2>How to Validate a Job</h2>
            <ol>
                <li>Ensure you own a subdomain identity under <code>club.agi.eth</code>.</li>
                <li>Enter your club subdomain identity in the "AGI Club Subdomain Identity" field and click "Verify Club Ownership".</li>
                <li>If the ownership verification is successful, the "Validate Job" button will appear.</li>
                <li>Click on the "Validate Job" button and follow the prompts to enter the Job ID and your club subdomain identity.</li>
                <li>The job validation process will require you to confirm the transaction in your wallet.</li>
            </ol>
        </div>
        <div class="verified-subdomains card">
            <h2>Verified Subdomains</h2>
            <ul id="verifiedSubdomainsList">
                <!-- Verified subdomains will be appended here -->
            </ul>
        </div>
        <div class="nft-section card">
            <h2>All Job NFTs</h2>
            <ul id="allNftList">
                <!-- All job NFTs will be listed here -->
            </ul>
        </div>
        <div class="nft-section card">
            <h2>Your NFTs</h2>
            <ul id="nftList">
                <!-- NFTs will be listed here -->
            </ul>
        </div>
        <h2>Jobs</h2>
        <table class="jobs-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Employer</th>
                    <th>IPFS Hash</th>
                    <th>Payout</th>
                    <th>Duration</th>
                    <th>Assigned Agent</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="jobs-table-body">
                <!-- Job rows will be populated here -->
            </tbody>
        </table>
        <div class="agi-purchase card">
            <h2>Buy $AGI Tokens</h2>
            <p>Enter the amount of ETH to spend to purchase $AGI:</p>
            <input type="number" id="ethAmount" placeholder="Amount in ETH">
            <button class="btn" onclick="buyAGITokens()">Buy $AGI</button>
            <p>$AGI is a Utility Token for exclusive use in the AGI.Eth Ecosystem. Not for investment purposes.</p>
        </div>
        <div class="card">
            <h2>Contact & Legal</h2>
            <p>Contact Email: <a href="mailto:secretariat@montreal.ai" id="contactEmail">secretariat@montreal.ai</a></p>
            <p>Terms & Conditions: <a href="https://ipfs.io/ipfs//Qmde8cZGZ7sKRbd8zy2EGy6mTUjjkBwU8ukegYvDW9opGR" target="_blank" id="termsAndConditionsLink">View Terms</a></p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@4.8.0/dist/web3.min.js"></script>
    <script>
        let web3;
        let agiJobManager;
        let agiToken;
        let agiTokenBuyer;
        let userAccount;

        const agiJobManagerAddress = "0x0178B6baD606aaF908f72135B8eC32Fc1D5bA477";
        const agiTokenBuyerAddress = "0xE7337BDDe55A453D36DabDf3c298988036DE1ba1";
        const agiJobManagerABI = [{"inputs":[{"internalType":"address","name":"_agiTokenAddress","type":"address"},{"internalType":"string","name":"_baseIpfsUrl","type":"string"},{"internalType":"address","name":"_ensAddress","type":"address"},{"internalType":"address","name":"_nameWrapperAddress","type":"address"},{"internalType":"bytes32","name":"_clubRootNode","type":"bytes32"},{"internalType":"bytes32","name":"_agentRootNode","type":"bytes32"},{"internalType":"bytes32","name":"_validatorMerkleRoot","type":"bytes32"},{"internalType":"bytes32","name":"_agentMerkleRoot","type":"bytes32"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"nftAddress","type":"address"},{"indexed":false,"internalType":"uint256","name":"payoutPercentage","type":"uint256"}],"name":"AGITypeUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"_fromTokenId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"_toTokenId","type":"uint256"}],"name":"BatchMetadataUpdate","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"jobId","type":"uint256"},{"indexed":false,"internalType":"address","name":"resolver","type":"address"},{"indexed":false,"internalType":"string","name":"resolution","type":"string"}],"name":"DisputeResolved","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"jobId","type":"uint256"},{"indexed":false,"internalType":"address","name":"agent","type":"address"}],"name":"JobApplied","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"jobId","type":"uint256"}],"name":"JobCancelled","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"jobId","type":"uint256"},{"indexed":false,"internalType":"address","name":"agent","type":"address"},{"indexed":false,"internalType":"uint256","name":"reputationPoints","type":"uint256"}],"name":"JobCompleted","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"jobId","type":"uint256"},{"indexed":false,"internalType":"address","name":"agent","type":"address"}],"name":"JobCompletionRequested","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"jobId","type":"uint256"},{"indexed":false,"internalType":"string","name":"ipfsHash","type":"string"},{"indexed":false,"internalType":"uint256","name":"payout","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"duration","type":"uint256"},{"indexed":false,"internalType":"string","name":"details","type":"string"}],"name":"JobCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"jobId","type":"uint256"},{"indexed":false,"internalType":"address","name":"validator","type":"address"}],"name":"JobDisapproved","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"jobId","type":"uint256"},{"indexed":false,"internalType":"address","name":"disputant","type":"address"}],"name":"JobDisputed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"jobId","type":"uint256"},{"indexed":false,"internalType":"address","name":"validator","type":"address"}],"name":"JobValidated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"newMerkleRoot","type":"bytes32"}],"name":"MerkleRootUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"_tokenId","type":"uint256"}],"name":"MetadataUpdate","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"NFTDelisted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":true,"internalType":"address","name":"employer","type":"address"},{"indexed":false,"internalType":"string","name":"tokenURI","type":"string"}],"name":"NFTIssued","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":true,"internalType":"address","name":"seller","type":"address"},{"indexed":false,"internalType":"uint256","name":"price","type":"uint256"}],"name":"NFTListed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"},{"indexed":true,"internalType":"address","name":"buyer","type":"address"},{"indexed":false,"internalType":"uint256","name":"price","type":"uint256"}],"name":"NFTPurchased","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"claimant","type":"address"},{"indexed":false,"internalType":"string","name":"subdomain","type":"string"}],"name":"OwnershipVerified","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"reason","type":"string"}],"name":"RecoveryInitiated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"newReputation","type":"uint256"}],"name":"ReputationUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"contributor","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RewardPoolContribution","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"newRootNode","type":"bytes32"}],"name":"RootNodeUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"inputs":[{"internalType":"address","name":"nftAddress","type":"address"},{"internalType":"uint256","name":"payoutPercentage","type":"uint256"}],"name":"addAGIType","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"agent","type":"address"}],"name":"addAdditionalAgent","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"validator","type":"address"}],"name":"addAdditionalValidator","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_moderator","type":"address"}],"name":"addModerator","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"additionalAgents","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"additionalText1","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"additionalText2","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"additionalText3","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"additionalValidators","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"agentMerkleRoot","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"agentRootNode","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"agiToken","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"agiTypes","outputs":[{"internalType":"address","name":"nftAddress","type":"address"},{"internalType":"uint256","name":"payoutPercentage","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_jobId","type":"uint256"},{"internalType":"string","name":"subdomain","type":"string"},{"internalType":"bytes32[]","name":"proof","type":"bytes32[]"}],"name":"applyForJob","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_agent","type":"address"},{"internalType":"bool","name":"_status","type":"bool"}],"name":"blacklistAgent","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_validator","type":"address"},{"internalType":"bool","name":"_status","type":"bool"}],"name":"blacklistValidator","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"blacklistedAgents","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"blacklistedValidators","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"canAccessPremiumFeature","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_jobId","type":"uint256"}],"name":"cancelJob","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"clubRootNode","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"contactEmail","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"contributeToRewardPool","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_ipfsHash","type":"string"},{"internalType":"uint256","name":"_payout","type":"uint256"},{"internalType":"uint256","name":"_duration","type":"uint256"},{"internalType":"string","name":"_details","type":"string"}],"name":"createJob","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_jobId","type":"uint256"}],"name":"delistJob","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"delistNFT","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_jobId","type":"uint256"},{"internalType":"string","name":"subdomain","type":"string"},{"internalType":"bytes32[]","name":"proof","type":"bytes32[]"}],"name":"disapproveJob","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_jobId","type":"uint256"}],"name":"disputeJob","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"ens","outputs":[{"internalType":"contract ENS","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"agent","type":"address"}],"name":"getHighestPayoutPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_jobId","type":"uint256"}],"name":"getJobStatus","outputs":[{"internalType":"bool","name":"","type":"bool"},{"internalType":"bool","name":"","type":"bool"},{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"jobDurationLimit","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"jobs","outputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"address","name":"employer","type":"address"},{"internalType":"string","name":"ipfsHash","type":"string"},{"internalType":"uint256","name":"payout","type":"uint256"},{"internalType":"uint256","name":"duration","type":"uint256"},{"internalType":"address","name":"assignedAgent","type":"address"},{"internalType":"uint256","name":"assignedAt","type":"uint256"},{"internalType":"bool","name":"completed","type":"bool"},{"internalType":"bool","name":"completionRequested","type":"bool"},{"internalType":"uint256","name":"validatorApprovals","type":"uint256"},{"internalType":"uint256","name":"validatorDisapprovals","type":"uint256"},{"internalType":"bool","name":"disputed","type":"bool"},{"internalType":"string","name":"details","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"}],"name":"listNFT","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"listings","outputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"isActive","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"maxJobPayout","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"moderators","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"nameWrapper","outputs":[{"internalType":"contract NameWrapper","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"nextJobId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"nextTokenId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"premiumReputationThreshold","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"purchaseNFT","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"agent","type":"address"}],"name":"removeAdditionalAgent","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"validator","type":"address"}],"name":"removeAdditionalValidator","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_moderator","type":"address"}],"name":"removeModerator","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"reputation","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_jobId","type":"uint256"},{"internalType":"string","name":"_ipfsHash","type":"string"}],"name":"requestJobCompletion","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"requiredValidatorApprovals","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"requiredValidatorDisapprovals","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_jobId","type":"uint256"},{"internalType":"string","name":"resolution","type":"string"}],"name":"resolveDispute","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_url","type":"string"}],"name":"setBaseIpfsUrl","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_limit","type":"uint256"}],"name":"setJobDurationLimit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_maxPayout","type":"uint256"}],"name":"setMaxJobPayout","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_threshold","type":"uint256"}],"name":"setPremiumReputationThreshold","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_approvals","type":"uint256"}],"name":"setRequiredValidatorApprovals","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_disapprovals","type":"uint256"}],"name":"setRequiredValidatorDisapprovals","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_percentage","type":"uint256"}],"name":"setValidationRewardPercentage","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"termsAndConditionsIpfsHash","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"unpause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_newTokenAddress","type":"address"}],"name":"updateAGITokenAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_text","type":"string"}],"name":"updateAdditionalText1","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_text","type":"string"}],"name":"updateAdditionalText2","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_text","type":"string"}],"name":"updateAdditionalText3","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_email","type":"string"}],"name":"updateContactEmail","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_hash","type":"string"}],"name":"updateTermsAndConditionsIpfsHash","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_jobId","type":"uint256"},{"internalType":"string","name":"subdomain","type":"string"},{"internalType":"bytes32[]","name":"proof","type":"bytes32[]"}],"name":"validateJob","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"validationRewardPercentage","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"validatorApprovedJobs","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"validatorMerkleRoot","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdrawAGI","outputs":[],"stateMutability":"nonpayable","type":"function"}] // Add your AGIJobManager ABI here
        const agiTokenABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"InvalidShortString","type":"error"},{"inputs":[{"internalType":"string","name":"str","type":"string"}],"name":"StringTooLong","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":false,"internalType":"bool","name":"isBlacklisted","type":"bool"}],"name":"BlacklistUpdated","type":"event"},{"anonymous":false,"inputs":[],"name":"EIP712DomainChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"}],"name":"Snapshot","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"buyTaxRate","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"sellTaxRate","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"transferTaxRate","type":"uint256"}],"name":"TaxRatesUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"taxReceiver","type":"address"}],"name":"TaxReceiverUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"inputs":[],"name":"DOMAIN_SEPARATOR","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"addToBlacklist","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"snapshotId","type":"uint256"}],"name":"balanceOfAt","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"burn","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"burnFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"buyTaxRate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"customBurn","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"eip712Domain","outputs":[{"internalType":"bytes1","name":"fields","type":"bytes1"},{"internalType":"string","name":"name","type":"string"},{"internalType":"string","name":"version","type":"string"},{"internalType":"uint256","name":"chainId","type":"uint256"},{"internalType":"address","name":"verifyingContract","type":"address"},{"internalType":"bytes32","name":"salt","type":"bytes32"},{"internalType":"uint256[]","name":"extensions","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"isBlacklisted","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"isExchange","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"nonces","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"},{"internalType":"uint256","name":"deadline","type":"uint256"},{"internalType":"uint8","name":"v","type":"uint8"},{"internalType":"bytes32","name":"r","type":"bytes32"},{"internalType":"bytes32","name":"s","type":"bytes32"}],"name":"permit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"removeFromBlacklist","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"sellTaxRate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"exchange","type":"address"},{"internalType":"bool","name":"status","type":"bool"}],"name":"setExchangeAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_buyTaxRate","type":"uint256"},{"internalType":"uint256","name":"_sellTaxRate","type":"uint256"},{"internalType":"uint256","name":"_transferTaxRate","type":"uint256"}],"name":"setTaxRates","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_taxReceiver","type":"address"}],"name":"setTaxReceiver","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"snapshot","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"taxReceiver","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"snapshotId","type":"uint256"}],"name":"totalSupplyAt","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"transferTaxRate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"unpause","outputs":[],"stateMutability":"nonpayable","type":"function"}] // Add your AGI token ABI here
        const agiTokenBuyerABI = [{"inputs":[{"internalType":"address","name":"_agiTokenAddress","type":"address"},{"internalType":"uint256","name":"_initialRate","type":"uint256"},{"internalType":"uint256","name":"_initialDailyLimit","type":"uint256"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"claimant","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"AirdropClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newLimit","type":"uint256"}],"name":"DailyLimitUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"newMerkleRoot","type":"bytes32"}],"name":"MerkleRootUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"buyer","type":"address"},{"indexed":false,"internalType":"uint256","name":"ethSpent","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"agiReceived","type":"uint256"}],"name":"Purchased","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"newRate","type":"uint256"}],"name":"RateUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bool","name":"isActive","type":"bool"}],"name":"WhitelistStatusChanged","type":"event"},{"inputs":[],"name":"RATE_PRECISION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"agiToken","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"airdropAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"buyAGI","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"bytes32[]","name":"_merkleProof","type":"bytes32[]"}],"name":"claimAirdrop","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"claimedAirdrop","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"confirmWithdrawAGI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"confirmWithdrawETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"dailyLimit","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isWhitelistActive","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"lastBoughtAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"lastPurchase","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"merkleRoot","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"rate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"setAirdropAmount","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"_merkleRoot","type":"bytes32"}],"name":"setMerkleRoot","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bool","name":"_isActive","type":"bool"}],"name":"setWhitelistStatus","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"unpause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newLimit","type":"uint256"}],"name":"updateDailyLimit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newRate","type":"uint256"}],"name":"updateRate","outputs":[],"stateMutability":"nonpayable","type":"function"}] // Add your AGITokenBuyer contract ABI here
        const nameWrapperABI = [{"inputs":[{"internalType":"contract ENS","name":"_ens","type":"address"},{"internalType":"contract IBaseRegistrar","name":"_registrar","type":"address"},{"internalType":"contract IMetadataService","name":"_metadataService","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"CannotUpgrade","type":"error"},{"inputs":[],"name":"IncompatibleParent","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"IncorrectTargetOwner","type":"error"},{"inputs":[],"name":"IncorrectTokenType","type":"error"},{"inputs":[{"internalType":"bytes32","name":"labelHash","type":"bytes32"},{"internalType":"bytes32","name":"expectedLabelhash","type":"bytes32"}],"name":"LabelMismatch","type":"error"},{"inputs":[{"internalType":"string","name":"label","type":"string"}],"name":"LabelTooLong","type":"error"},{"inputs":[],"name":"LabelTooShort","type":"error"},{"inputs":[],"name":"NameIsNotWrapped","type":"error"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"name":"OperationProhibited","type":"error"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"address","name":"addr","type":"address"}],"name":"Unauthorised","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"controller","type":"address"},{"indexed":false,"internalType":"bool","name":"active","type":"bool"}],"name":"ControllerChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"uint64","name":"expiry","type":"uint64"}],"name":"ExpiryExtended","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"uint32","name":"fuses","type":"uint32"}],"name":"FusesSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"address","name":"owner","type":"address"}],"name":"NameUnwrapped","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"node","type":"bytes32"},{"indexed":false,"internalType":"bytes","name":"name","type":"bytes"},{"indexed":false,"internalType":"address","name":"owner","type":"address"},{"indexed":false,"internalType":"uint32","name":"fuses","type":"uint32"},{"indexed":false,"internalType":"uint64","name":"expiry","type":"uint64"}],"name":"NameWrapped","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"indexed":false,"internalType":"uint256[]","name":"values","type":"uint256[]"}],"name":"TransferBatch","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"TransferSingle","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"value","type":"string"},{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"}],"name":"URI","type":"event"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"_tokens","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"uint32","name":"fuseMask","type":"uint32"}],"name":"allFusesBurned","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address[]","name":"accounts","type":"address[]"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"}],"name":"balanceOfBatch","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"address","name":"addr","type":"address"}],"name":"canExtendSubnames","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"address","name":"addr","type":"address"}],"name":"canModifyName","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"controllers","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"ens","outputs":[{"internalType":"contract ENS","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"parentNode","type":"bytes32"},{"internalType":"bytes32","name":"labelhash","type":"bytes32"},{"internalType":"uint64","name":"expiry","type":"uint64"}],"name":"extendExpiry","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"operator","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"getData","outputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint32","name":"fuses","type":"uint32"},{"internalType":"uint64","name":"expiry","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"parentNode","type":"bytes32"},{"internalType":"bytes32","name":"labelhash","type":"bytes32"}],"name":"isWrapped","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"name":"isWrapped","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"metadataService","outputs":[{"internalType":"contract IMetadataService","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"names","outputs":[{"internalType":"bytes","name":"","type":"bytes"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"onERC721Received","outputs":[{"internalType":"bytes4","name":"","type":"bytes4"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"id","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"owner","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_token","type":"address"},{"internalType":"address","name":"_to","type":"address"},{"internalType":"uint256","name":"_amount","type":"uint256"}],"name":"recoverFunds","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"label","type":"string"},{"internalType":"address","name":"wrappedOwner","type":"address"},{"internalType":"uint256","name":"duration","type":"uint256"},{"internalType":"address","name":"resolver","type":"address"},{"internalType":"uint16","name":"ownerControlledFuses","type":"uint16"}],"name":"registerAndWrapETH2LD","outputs":[{"internalType":"uint256","name":"registrarExpiry","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"registrar","outputs":[{"internalType":"contract IBaseRegistrar","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"duration","type":"uint256"}],"name":"renew","outputs":[{"internalType":"uint256","name":"expires","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"internalType":"uint256[]","name":"amounts","type":"uint256[]"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeBatchTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"parentNode","type":"bytes32"},{"internalType":"bytes32","name":"labelhash","type":"bytes32"},{"internalType":"uint32","name":"fuses","type":"uint32"},{"internalType":"uint64","name":"expiry","type":"uint64"}],"name":"setChildFuses","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"controller","type":"address"},{"internalType":"bool","name":"active","type":"bool"}],"name":"setController","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"uint16","name":"ownerControlledFuses","type":"uint16"}],"name":"setFuses","outputs":[{"internalType":"uint32","name":"","type":"uint32"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"contract IMetadataService","name":"_metadataService","type":"address"}],"name":"setMetadataService","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"resolver","type":"address"},{"internalType":"uint64","name":"ttl","type":"uint64"}],"name":"setRecord","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"address","name":"resolver","type":"address"}],"name":"setResolver","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"parentNode","type":"bytes32"},{"internalType":"string","name":"label","type":"string"},{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint32","name":"fuses","type":"uint32"},{"internalType":"uint64","name":"expiry","type":"uint64"}],"name":"setSubnodeOwner","outputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"parentNode","type":"bytes32"},{"internalType":"string","name":"label","type":"string"},{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"resolver","type":"address"},{"internalType":"uint64","name":"ttl","type":"uint64"},{"internalType":"uint32","name":"fuses","type":"uint32"},{"internalType":"uint64","name":"expiry","type":"uint64"}],"name":"setSubnodeRecord","outputs":[{"internalType":"bytes32","name":"node","type":"bytes32"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"node","type":"bytes32"},{"internalType":"uint64","name":"ttl","type":"uint64"}],"name":"setTTL","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"contract INameWrapperUpgrade","name":"_upgradeAddress","type":"address"}],"name":"setUpgradeContract","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"parentNode","type":"bytes32"},{"internalType":"bytes32","name":"labelhash","type":"bytes32"},{"internalType":"address","name":"controller","type":"address"}],"name":"unwrap","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"labelhash","type":"bytes32"},{"internalType":"address","name":"registrant","type":"address"},{"internalType":"address","name":"controller","type":"address"}],"name":"unwrapETH2LD","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes","name":"name","type":"bytes"},{"internalType":"bytes","name":"extraData","type":"bytes"}],"name":"upgrade","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"upgradeContract","outputs":[{"internalType":"contract INameWrapperUpgrade","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"uri","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes","name":"name","type":"bytes"},{"internalType":"address","name":"wrappedOwner","type":"address"},{"internalType":"address","name":"resolver","type":"address"}],"name":"wrap","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"label","type":"string"},{"internalType":"address","name":"wrappedOwner","type":"address"},{"internalType":"uint16","name":"ownerControlledFuses","type":"uint16"},{"internalType":"address","name":"resolver","type":"address"}],"name":"wrapETH2LD","outputs":[{"internalType":"uint64","name":"expiry","type":"uint64"}],"stateMutability":"nonpayable","type":"function"}] // Add the NameWrapper ABI here
        const nameWrapperAddress = "0xD4416b13d2b3a9aBae7AcD5D6C2BbDBE25686401";
        const verifiedSubdomains = [];

        async function connectWallet() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAccount = (await web3.eth.getAccounts())[0];
                agiJobManager = new web3.eth.Contract(agiJobManagerABI, agiJobManagerAddress);
                agiTokenBuyer = new web3.eth.Contract(agiTokenBuyerABI, agiTokenBuyerAddress);
                const agiTokenAddress = await agiJobManager.methods.agiToken().call();
                agiToken = new web3.eth.Contract(agiTokenABI, agiTokenAddress);
                await updateDashboard();
            } else {
                alert('Please install MetaMask!');
            }
        }

        async function updateDashboard() {
            try {
                const totalJobs = await agiJobManager.methods.nextJobId().call();
                document.getElementById('total-jobs').textContent = totalJobs;

                const balance = await agiToken.methods.balanceOf(userAccount).call();
                const reputation = await agiJobManager.methods.reputation(userAccount).call();
                const myJobs = await getJobsByOwner(userAccount);
                document.getElementById('agi-balance').textContent = web3.utils.fromWei(balance, 'ether');
                document.getElementById('my-reputation').textContent = reputation;
                document.getElementById('my-jobs').textContent = myJobs.length;

                await loadJobs();
                await loadNFTs();
                await loadAllNFTs();

                const validatorApprovals = await agiJobManager.methods.requiredValidatorApprovals().call();
                const validatorDisapprovals = await agiJobManager.methods.requiredValidatorDisapprovals().call();
                document.getElementById('validator-approvals').textContent = validatorApprovals;
                document.getElementById('validator-disapprovals').textContent = validatorDisapprovals;

                const contactEmail = await agiJobManager.methods.contactEmail().call();
                document.getElementById('contactEmail').textContent = contactEmail;
                document.getElementById('contactEmail').href = `mailto:${contactEmail}`;

                const termsAndConditionsIpfsHash = await agiJobManager.methods.termsAndConditionsIpfsHash().call();
                document.getElementById('termsAndConditionsLink').href = `https://ipfs.io/ipfs/${termsAndConditionsIpfsHash}`;
            } catch (error) {
                console.error('Error updating dashboard:', error);
            }
        }

        async function loadJobs() {
            try {
                const totalJobs = await agiJobManager.methods.nextJobId().call();
                const jobsTableBody = document.getElementById('jobs-table-body');
                jobsTableBody.innerHTML = '';

                for (let i = 0; i < totalJobs; i++) {
                    const job = await agiJobManager.methods.jobs(i).call();
                    const row = `<tr>
                        <td>${job.id}</td>
                        <td>${job.employer}</td>
                        <td>${job.ipfsHash}</td>
                        <td>${web3.utils.fromWei(job.payout, 'ether')}</td>
                        <td>${job.duration}</td>
                        <td>${job.assignedAgent || 'Unassigned'}</td>
                        <td>${job.completed ? 'Completed' : 'Ongoing'}</td>
                    </tr>`;
                    jobsTableBody.innerHTML += row;
                }
            } catch (error) {
                console.error('Error loading jobs:', error);
            }
        }

        async function getJobsByOwner(ownerAddress) {
            const totalJobs = await agiJobManager.methods.nextJobId().call();
            let jobs = [];
            for (let i = 0; i < totalJobs; i++) {
                const job = await agiJobManager.methods.jobs(i).call();
                if (job.employer === ownerAddress) {
                    jobs.push(job);
                }
            }
            return jobs;
        }

        async function checkApproval(amount) {
            const allowance = await agiToken.methods.allowance(userAccount, agiJobManagerAddress).call();
            if (allowance < amount) {
                if (!confirm(`You need to approve ${web3.utils.fromWei(amount, 'ether')} $AGI to create this job. Do you want to approve?`)) {
                    return false;
                }
                await agiToken.methods.approve(agiJobManagerAddress, amount).send({ from: userAccount });
            }
            return true;
        }

        async function createJob() {
            try {
                const ipfsHash = prompt("Enter IPFS Hash:");
                const payout = prompt("Enter Payout Amount:");
                const duration = prompt("Enter Duration in Seconds:");
                const details = prompt("Enter Job Details:");
                if (!ipfsHash || !payout || !duration || !details) return;

                const payoutWei = web3.utils.toWei(payout, 'ether');
                const approvalGranted = await checkApproval(payoutWei);
                if (!approvalGranted) return;

                await agiJobManager.methods.createJob(ipfsHash, payoutWei, duration, details).send({ from: userAccount });
                await updateDashboard();
            } catch (error) {
                console.error('Error creating job:', error);
            }
        }

        async function applyForJob() {
            try {
                const jobId = prompt("Enter Job ID to Apply:");
                if (!jobId) return;

                const subdomain = prompt("Enter Agent Subdomain:");
                const proof = []; // Gather proof from user or other source if needed

                await agiJobManager.methods.applyForJob(jobId, subdomain, proof).send({ from: userAccount });
                await updateDashboard();
            } catch (error) {
                console.error('Error applying for job:', error);
            }
        }

        async function requestJobCompletion() {
            try {
                const jobId = prompt("Enter Job ID to Request Completion:");
                const ipfsHash = prompt("Enter IPFS Hash:");
                if (!jobId || !ipfsHash) return;

                await agiJobManager.methods.requestJobCompletion(jobId, ipfsHash).send({ from: userAccount });
                await updateDashboard();
            } catch (error) {
                console.error('Error requesting job completion:', error);
            }
        }

        async function verifyAgentOwnership() {
            await verifyOwnership('subdomainAgent', 'outputAgent', 'agent.agi.eth');
        }

        async function verifyNodeOwnership() {
            await verifyOwnership('subdomainNode', 'outputNode', 'node.agi.eth');
        }

        async function verifyClubOwnership() {
            await verifyOwnership('subdomainClub', 'outputClub', 'club.agi.eth');
        }

        async function verifyOwnership(inputId, outputId, domainSuffix) {
            const subdomainPart = document.getElementById(inputId).value.trim();
            if (typeof subdomainPart !== 'string' || !subdomainPart.match(/^[a-z0-9-]+$/)) {
                document.getElementById(outputId).textContent = 'Invalid subdomain format. Please enter only lowercase letters, numbers, and hyphens.';
                return;
            }
            const fullSubdomain = `${subdomainPart}.${domainSuffix}`;
            const tokenID = namehash(fullSubdomain);
            const nameWrapper = new web3.eth.Contract(nameWrapperABI, nameWrapperAddress);

            try {
                const owner = await nameWrapper.methods.ownerOf(tokenID).call();
                const outputElement = document.getElementById(outputId);
                if (owner.toLowerCase() === userAccount.toLowerCase()) {
                    outputElement.textContent = `You own the subdomain: ${fullSubdomain}`;
                    addVerifiedSubdomain(fullSubdomain);
                    if (domainSuffix === 'club.agi.eth') {
                        document.getElementById('validateJobBtn').style.display = 'block';
                    }
                } else {
                    outputElement.textContent = `You do not own the subdomain: ${fullSubdomain}`;
                }
            } catch (error) {
                document.getElementById(outputId).textContent = `Error verifying ownership: ${error.message}`;
            }
        }

        function addVerifiedSubdomain(subdomain) {
            if (!verifiedSubdomains.includes(subdomain)) {
                verifiedSubdomains.push(subdomain);
                const listElement = document.createElement('li');
                listElement.textContent = subdomain;
                document.getElementById('verifiedSubdomainsList').appendChild(listElement);
            }
        }

        function namehash(name) {
            const keccak = web3.utils.keccak256;
            let node = '0x0000000000000000000000000000000000000000000000000000000000000000';
            if (name !== '') {
                const labels = name.split('.');
                for (let i = labels.length - 1; i >= 0; i--) {
                    node = keccak(node + keccak(labels[i]).replace('0x', ''));
                }
            }
            return node;
        }

        async function loadNFTs() {
            try {
                const nftList = document.getElementById('nftList');
                nftList.innerHTML = '';
                const totalNFTs = await agiJobManager.methods.nextTokenId().call();
                for (let i = 0; i < totalNFTs; i++) {
                    if (await agiJobManager.methods.ownerOf(i).call() === userAccount) {
                        const tokenURI = await agiJobManager.methods.tokenURI(i).call();
                        const listItem = `<li class="nft-list-item">
                                <img src="agijobs360v0.png" alt="NFT Image" class="nft-image">
                                Token ID: ${i}, URI: <a href="${getIPFSUrl(tokenURI)}" target="_blank" class="nft-link">${tokenURI}</a>
                                ${await getNftButtons(i)}
                            </li>`;
                        nftList.innerHTML += listItem;
                    }
                }
            } catch (error) {
                console.error('Error loading NFTs:', error);
            }
        }

        async function loadAllNFTs() {
            try {
                const allNftList = document.getElementById('allNftList');
                allNftList.innerHTML = '';
                const totalNFTs = await agiJobManager.methods.nextTokenId().call();
                for (let i = 0; i < totalNFTs; i++) {
                    const tokenURI = await agiJobManager.methods.tokenURI(i).call();
                    const listing = await agiJobManager.methods.listings(i).call();
                    const price = web3.utils.fromWei(listing.price, 'ether');
                    const button = listing.isActive ? `<button class="btn" onclick="purchaseNFT(${i})">Purchase for ${price} $AGI</button>` : '';
                    const listItem = `<li class="nft-list-item">
                            <img src="agijobs360v0.png" alt="NFT Image" class="nft-image">
                            Token ID: ${i}, URI: <a href="${getIPFSUrl(tokenURI)}" target="_blank" class="nft-link">${tokenURI}</a>
                            ${button}
                        </li>`;
                    allNftList.innerHTML += listItem;
                }
            } catch (error) {
                console.error('Error loading all NFTs:', error);
            }
        }

        async function getNftButtons(tokenId) {
            const listing = await agiJobManager.methods.listings(tokenId).call();
            let buttons = '';
            if (listing.isActive && listing.seller.toLowerCase() === userAccount.toLowerCase()) {
                buttons += `<button class="btn" onclick="delistNFT(${tokenId})">Delist</button>`;
            } else if (!listing.isActive) {
                buttons += `<button class="btn" onclick="listNFT(${tokenId})">List</button>`;
            }
            return buttons;
        }

        async function validateJob() {
            try {
                const jobId = prompt("Enter Job ID to Validate:");
                if (!jobId) return;

                const subdomain = prompt("Enter Club Subdomain:");
                const proof = []; // Gather proof from user or other source if needed

                await agiJobManager.methods.validateJob(jobId, subdomain, proof).send({ from: userAccount });
                await updateDashboard();
            } catch (error) {
                console.error('Error validating job:', error);
            }
        }

        async function listNFT(tokenId) {
            const price = prompt("Enter price in $AGI:");
            if (!price) return;

            try {
                const priceWei = web3.utils.toWei(price, 'ether');
                await agiJobManager.methods.listNFT(tokenId, priceWei).send({ from: userAccount });
                await updateDashboard();
            } catch (error) {
                console.error('Error listing NFT:', error);
            }
        }

        async function purchaseNFT(tokenId) {
            try {
                const listing = await agiJobManager.methods.listings(tokenId).call();
                const price = listing.price;
                const allowance = await agiToken.methods.allowance(userAccount, agiJobManagerAddress).call();
                
                if (allowance < price) {
                    await agiToken.methods.approve(agiJobManagerAddress, price).send({ from: userAccount });
                }

                await agiJobManager.methods.purchaseNFT(tokenId).send({ from: userAccount });
                await updateDashboard();
            } catch (error) {
                console.error('Error purchasing NFT:', error);
            }
        }

        async function delistNFT(tokenId) {
            try {
                await agiJobManager.methods.delistNFT(tokenId).send({ from: userAccount });
                await updateDashboard();
            } catch (error) {
                console.error('Error delisting NFT:', error);
            }
        }

        function getIPFSUrl(ipfsHash) {
            return `https://ipfs.io/ipfs/${ipfsHash}`;
        }

        async function buyAGITokens() {
            const ethAmount = document.getElementById('ethAmount').value;
            if (!ethAmount || ethAmount <= 0) {
                alert('Please enter a valid amount of ETH.');
                return;
            }

            try {
                await agiTokenBuyer.methods.buyAGI().send({ from: userAccount, value: web3.utils.toWei(ethAmount, 'ether') });
                alert('Successfully purchased $AGI tokens!');
                await updateDashboard();
            } catch (error) {
                console.error('Error buying $AGI tokens:', error);
                alert('Error buying $AGI tokens. Please try again.');
            }
        }

        async function refreshData() {
            await updateDashboard();
        }

        window.onload = connectWallet;
    </script>
</body>
</html>

